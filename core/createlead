#! /usr/local/bin/bash

# Parameters: product-type expediting_option [email] [passportrenewal]

# Check for required params
echo "${1:?Must provide a product}" > /dev/null
echo "${2:?Must provide an expediting option}" > /dev/null
echo "${3:?Must provide an email}" > /dev/null

HOTLEAD_URL="$API_URL/hotlead"

PRODUCT="$(get_product $1)"

if [[ -z "$4" || "$4" == "passportcenter" ]] #If the 4th parameter is empty or is passportcenter
then
    OPTION="$(get_option_pc $2)"
    SOURCE='passportcenter'
else #Right now you could just pass anything as the second parameter and the source will be set to passportrenewal lol
    OPTION="$(get_option_pr $2)";
    SOURCE='fastpassport';
fi

echo "Createlead: Product is: $PRODUCT"
echo "Createlead: Option is: $OPTION"

EMAIL=$3
set_name
echo "Create Lead: Creating a $(cyan "$2 $1") lead on $(yellow "$SOURCE") under the email $(purple "$3") for $(purple "$FIRSTNAME")"

api_call "$HOTLEAD_URL" $'{"source":"'"$SOURCE"'","itinerary":{"destinations":[{"country":null,"dates":{"startDate":null,"endDate":null}}],"travelers":{"adults":1,"children":0}},"travelers":[{"info":{"first_name":"'$FIRSTNAME'","last_name":"'$LASTNAME'","citizenship":null,"residency":null,"date_of_birth":"10/10/1989"},"products":[{"uuid":"'"$PRODUCT"'","option_uuid":"'"$OPTION"'","outbound_speed":"usps_priority_overnight","option_label":"Standard","product_label":"Passport Renewal","service_type":"standard_service","cost":149,"addons":[]}]}],"user_profile":{"first_name":"'$FIRSTNAME'","last_name":"'$LASTNAME'","email":"'"$EMAIL"'","phones":[{"type":"mobile","friendly_name":"Mobile Number","country":"US","value":"3456785432","disabled":true,"required":true,"hint":"Well use this number to send SMS notifications."},{"type":"landline","friendly_name":"Home or Office Number","country":"US","value":""}],"country":"US","company_name":null,"addresses":[{"type":"billing","address_1":"","address_2":"","city":"","state":"","country":"US","postal_code":""},{"type":"shipping","address_1":"","address_2":"","city":"","state":"","country":"US","postal_code":""}]},"gw_tracker":{"referer":"direct","query_string":""}}'